(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{8295:function(e,o,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[roomId]",function(){return l(4707)}])},4707:function(e,o,l){"use strict";l.r(o);var t=l(5893),n=l(8583),a=l(1163),r=l(7294),i=l(6221),c=l(9854),_=l(3483),s=l(6819),d=l(6303),u=l.n(d);o.default=()=>{let[e]=(0,n.KO)(i.L),o=(0,a.useRouter)(),{roomId:l}=o.query,[d,f]=(0,r.useState)(),[h,p]=(0,r.useState)([[]]),fetchRoomData=async()=>{let e=await _.x.rooms.$get().catch(s.F);if(!e)return;let o=e.find(e=>e.id===l);if(o){let e=await _.x.rooms.board.$get({query:{roomId:o.id,turnColor:o.currentTurn}}).catch(s.F);null!==e&&(p(e),f(o))}},leaveRoom=async()=>{if(!d)return;let e=await _.x.rooms.$patch({body:{roomId:d.id}}).catch(s.F);null!==e&&await o.push("/")},clickCell=async(e,o)=>{if(!d)return;let l=await _.x.rooms.board.$post({body:{x:e,y:o,roomId:d.id}});l&&await fetchRoomData()},judgeColor=e=>{let o=null==d?void 0:d.userOnRooms.filter(e=>null===e.out).sort((e,o)=>e.in-o.in),l=null==o?void 0:o.findIndex(o=>o.firebaseId===e);return 0===l?1:2},handleOpponentLeave=()=>{d&&(alert("対戦相手が部屋を出たため、対局が終了しました"),leaveRoom())},handleGameEnd=()=>{if(!d||!e)return;let o=judgeColor(e.id)===d.winner?"あなた":"相手";alert("".concat(o,"の勝ちです")),leaveRoom()},defineCellStyle=o=>{if(d&&e)return -1===o?d.currentTurn===judgeColor(e.id)?"".concat(u().stone," ").concat(u().placeable):"":u().stone};return((0,r.useEffect)(()=>{if((null==d?void 0:d.winner)===1||(null==d?void 0:d.winner)===2){handleGameEnd();return}if((null==d?void 0:d.status)==="ended"){handleOpponentLeave();return}let e=setInterval(fetchRoomData,1e3);return()=>clearInterval(e)}),d&&e)?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:u().gameScreen,children:[(0,t.jsx)("button",{onClick:leaveRoom,className:u().leaveButton,children:"部屋を出る"}),(0,t.jsxs)("p",{children:["現在は",1===d.currentTurn?"黒":"白","のターン"]}),(0,t.jsxs)("div",{className:u().gameInfo,children:[(0,t.jsxs)("div",{className:"".concat(u().playerInfo," ").concat(u().playerSelf," ").concat(u().playerLeft),children:["あなたは",1===judgeColor(e.id)?"黒":"白","です"]}),(0,t.jsx)("div",{className:u().boardContainer,children:(0,t.jsx)("div",{className:u().board,children:h.map((e,o)=>e.map((e,l)=>(0,t.jsx)("div",{className:u().cell,onClick:()=>clickCell(l,o),children:0!==e&&(0,t.jsx)("div",{className:"".concat(defineCellStyle(e)),style:{background:1===e?"#000":2===e?"#fff":""}})},"".concat(l,"-").concat(o))))})}),d.userOnRooms.filter(o=>null===o.out&&o.firebaseId!==e.id).map(e=>(0,t.jsxs)("div",{className:"".concat(u().playerInfo," ").concat(u().playerOpponent," ").concat(u().playerRight),children:["相手は",1===judgeColor(e.firebaseId)?"黒":"白","です"]},e.firebaseId))]})]})}):(0,t.jsx)(c.g,{visible:!0})}},6303:function(e){e.exports={container:"othello_container__EH3nh",main:"othello_main__UdmT8",footer:"othello_footer__X99rz",title:"othello_title__JbmI8",description:"othello_description__sQQ4C",code:"othello_code__d8YDI",grid:"othello_grid__g6oYB",card:"othello_card__JrL8E",logo:"othello_logo__Cm3Wy",board:"othello_board__Q1q7Y",cell:"othello_cell__Biu_Q",stone:"othello_stone__H9K0Y",placeable:"othello_placeable__5AcoO",leaveButton:"othello_leaveButton__oQxqP",gameScreen:"othello_gameScreen__C8vP2",gameInfo:"othello_gameInfo__k9yvt",playerInfo:"othello_playerInfo__sBXaS",playerSelf:"othello_playerSelf__CzNSi",playerOpponent:"othello_playerOpponent__sGG_T",boardContainer:"othello_boardContainer__amWol",playerLeft:"othello_playerLeft__Vf2fp",playerRight:"othello_playerRight__PfxOm",userInfo:"othello_userInfo__VZPiB",userSelf:"othello_userSelf__RFve4",userOpponent:"othello_userOpponent__U9rxd"}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8295)}),_N_E=e.O()}]);