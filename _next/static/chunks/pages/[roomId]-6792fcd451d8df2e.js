(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{8295:function(e,o,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[roomId]",function(){return r(1450)}])},1450:function(e,o,r){"use strict";r.r(o),r.d(o,{default:function(){return index_page}});var n=r(5893),t=r(7294),a=r(9854),_=r(3483),l=r(6819);let judgeColor=(e,o)=>{let r=null==o?void 0:o.userOnRooms.filter(e=>null===e.out).sort((e,o)=>e.in-o.in),n=null==r?void 0:r.findIndex(o=>o.firebaseId===e);return 0===n?1:2};var c=r(8583),d=r(1163),i=r(6221);let useRoomData=()=>{let[e]=(0,c.KO)(i.L),o=(0,d.useRouter)(),{roomId:r}=o.query,[n,a]=(0,t.useState)(),[s,u]=(0,t.useState)([[]]),fetchRooms=async()=>{let e=await _.x.rooms.$get().catch(l.F);return e||null},fetchPlaceableMatrix=async(e,o)=>{let r=await _.x.rooms.board.$get({query:{roomId:e,turnColor:o}}).catch(l.F);return r||null},fetchAndSetRoomData=async()=>{let e=await fetchRooms();if(!e)return;let o=e.find(e=>e.id===r);if(!o)return;let n=await fetchPlaceableMatrix(o.id,o.currentTurn);n&&(u(n),a(o))};return{room:n,user:e,router:o,placeableMatrix:s,fetchAndSetRoomData}};var s=r(7794),u=r.n(s),index_page=()=>{let{room:e,user:o,router:r,placeableMatrix:c,fetchAndSetRoomData:d}=useRoomData();if((0,t.useEffect)(()=>{if((null==e?void 0:e.winner)===1||(null==e?void 0:e.winner)===2){handleGameEnd();return}if((null==e?void 0:e.status)==="ended"){handleOpponentLeave();return}let o=setInterval(d,1e3);return()=>clearInterval(o)}),void 0===e||!o)return(0,n.jsx)(a.g,{visible:!0});let i=judgeColor(o.id,e),leaveRoom=async()=>{let o=await _.x.rooms.$patch({body:{roomId:e.id}}).catch(l.F);null!==o&&await r.push("/")},clickCell=async(o,r)=>{let n=await _.x.rooms.board.$post({body:{x:o,y:r,roomId:e.id}});n&&await d()},handleOpponentLeave=()=>{alert("対戦相手が部屋を出たため、対局が終了しました"),leaveRoom()},handleGameEnd=()=>{let o=i===e.winner?"あなた":"相手";alert("".concat(o,"の勝ちです")),leaveRoom()},defineCellStyle=o=>-1===o?e.currentTurn===i?"".concat(u().stone," ").concat(u().placeable):"":u().stone,convertColorToString=e=>1===e?"黒":"白";return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:u().gameScreen,children:[(0,n.jsx)("button",{onClick:leaveRoom,className:u().leaveButton,children:"部屋を出る"}),"waiting"===e.status?(0,n.jsx)("p",{children:"対戦相手を待っています"}):(0,n.jsxs)("p",{children:["現在は",convertColorToString(e.currentTurn),"のターン"]}),(0,n.jsxs)("div",{className:u().gameInfo,children:[(0,n.jsxs)("div",{className:"".concat(u().playerInfo," ").concat(u().playerSelf," ").concat(u().playerLeft),children:["あなたは",convertColorToString(i),"です"]}),(0,n.jsx)("div",{className:u().boardContainer,children:(0,n.jsx)("div",{className:u().board,children:c.map((e,o)=>e.map((e,r)=>(0,n.jsx)("div",{className:u().cell,onClick:()=>clickCell(r,o),children:0!==e&&(0,n.jsx)("div",{className:"".concat(defineCellStyle(e)),style:{background:1===e?"#000":2===e?"#fff":""}})},"".concat(r,"-").concat(o))))})}),e.userOnRooms.filter(e=>null===e.out&&e.firebaseId!==o.id).map(o=>(0,n.jsxs)("div",{className:"".concat(u().playerInfo," ").concat(u().playerOpponent," ").concat(u().playerRight),children:["相手は",convertColorToString(judgeColor(o.firebaseId,e)),"です"]},o.firebaseId))]})]})})}},7794:function(e){e.exports={container:"_roomId__container__bhcEk",main:"_roomId__main__xEhbk",footer:"_roomId__footer__5JuK_",title:"_roomId__title__tK5yn",description:"_roomId__description__gdszg",code:"_roomId__code__ajiqF",grid:"_roomId__grid__cQp2R",card:"_roomId__card__A8tLx",logo:"_roomId__logo__m2oU_",board:"_roomId__board__FCi4O",cell:"_roomId__cell__A40dx",stone:"_roomId__stone__ER09g",placeable:"_roomId__placeable__3pN_c",leaveButton:"_roomId__leaveButton__bT1dY",gameScreen:"_roomId__gameScreen__iMdSO",gameInfo:"_roomId__gameInfo__biTuf",playerInfo:"_roomId__playerInfo__KQ0u9",playerSelf:"_roomId__playerSelf__jc68x",playerOpponent:"_roomId__playerOpponent__peHNX",boardContainer:"_roomId__boardContainer__uFQZM",playerLeft:"_roomId__playerLeft__tz3OZ",playerRight:"_roomId__playerRight__k06ze",userInfo:"_roomId__userInfo__GqWcK",userSelf:"_roomId__userSelf__Ynxqs",userOpponent:"_roomId__userOpponent__n_zkD"}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8295)}),_N_E=e.O()}]);