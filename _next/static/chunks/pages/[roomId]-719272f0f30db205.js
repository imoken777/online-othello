(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{8295:function(e,o,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[roomId]",function(){return n(1450)}])},1450:function(e,o,n){"use strict";n.r(o),n.d(o,{default:function(){return index_page}});var r=n(5893),a=n(7294),t=n(9854),_=n(3483),l=n(6819);let judgeColor=(e,o)=>{let n=null==o?void 0:o.userOnRooms.filter(e=>null===e.out).sort((e,o)=>e.in-o.in),r=null==n?void 0:n.findIndex(o=>o.firebaseId===e);return 0===r?1:2};var d=n(8583),c=n(1163),i=n(6221);let useRoomData=()=>{let[e]=(0,d.KO)(i.L),o=(0,c.useRouter)(),{roomId:n}=o.query,[r,t]=(0,a.useState)(),[s,u]=(0,a.useState)([[]]),fetchRooms=async()=>{let e=await _.x.rooms.$get().catch(l.F);return e||null},fetchPlaceableMatrix=async(e,o)=>{let n=await _.x.rooms.board.$get({query:{roomId:e,turnColor:o}}).catch(l.F);return n||null},fetchAndSetRoomData=async()=>{let e=await fetchRooms();if(!e)return;let o=e.find(e=>e.id===n);if(!o)return;let r=await fetchPlaceableMatrix(o.id,o.currentTurn);r&&(u(r),t(o))};return{room:r,user:e,router:o,placeableMatrix:s,fetchAndSetRoomData}};var s=n(7794),u=n.n(s),index_page=()=>{let{room:e,user:o,router:n,placeableMatrix:d,fetchAndSetRoomData:c}=useRoomData();if((0,a.useEffect)(()=>{if((null==e?void 0:e.winner)===1||(null==e?void 0:e.winner)===2){handleGameEnd();return}if((null==e?void 0:e.status)==="ended"){handleOpponentLeave();return}let o=setInterval(c,1e3);return()=>clearInterval(o)}),!e||!o)return(0,r.jsx)(t.g,{visible:!0});let i=judgeColor(o.id,e),leaveRoom=async()=>{let o=await _.x.rooms.$patch({body:{roomId:e.id}}).catch(l.F);null!==o&&await n.push("/")},clickCell=async(o,n)=>{let r=await _.x.rooms.board.$post({body:{x:o,y:n,roomId:e.id}});r&&await c()},handleOpponentLeave=()=>{alert("対戦相手が部屋を出たため、対局が終了しました"),leaveRoom()},handleGameEnd=()=>{let o=i===e.winner?"あなた":"相手";alert("".concat(o,"の勝ちです")),leaveRoom()},defineCellStyle=o=>-1===o?e.currentTurn===i?"".concat(u().stone," ").concat(u().placeable):"":u().stone;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:u().gameScreen,children:[(0,r.jsx)("button",{onClick:leaveRoom,className:u().leaveButton,children:"部屋を出る"}),(0,r.jsxs)("p",{children:["現在は",1===e.currentTurn?"黒":"白","のターン"]}),(0,r.jsxs)("div",{className:u().gameInfo,children:[(0,r.jsxs)("div",{className:"".concat(u().playerInfo," ").concat(u().playerSelf," ").concat(u().playerLeft),children:["あなたは",1===i?"黒":"白","です"]}),(0,r.jsx)("div",{className:u().boardContainer,children:(0,r.jsx)("div",{className:u().board,children:d.map((e,o)=>e.map((e,n)=>(0,r.jsx)("div",{className:u().cell,onClick:()=>clickCell(n,o),children:0!==e&&(0,r.jsx)("div",{className:"".concat(defineCellStyle(e)),style:{background:1===e?"#000":2===e?"#fff":""}})},"".concat(n,"-").concat(o))))})}),e.userOnRooms.filter(e=>null===e.out&&e.firebaseId!==o.id).map(o=>(0,r.jsxs)("div",{className:"".concat(u().playerInfo," ").concat(u().playerOpponent," ").concat(u().playerRight),children:["相手は",1===judgeColor(o.firebaseId,e)?"黒":"白","です"]},o.firebaseId))]})]})})}},7794:function(e){e.exports={container:"_roomId__container__bhcEk",main:"_roomId__main__xEhbk",footer:"_roomId__footer__5JuK_",title:"_roomId__title__tK5yn",description:"_roomId__description__gdszg",code:"_roomId__code__ajiqF",grid:"_roomId__grid__cQp2R",card:"_roomId__card__A8tLx",logo:"_roomId__logo__m2oU_",board:"_roomId__board__FCi4O",cell:"_roomId__cell__A40dx",stone:"_roomId__stone__ER09g",placeable:"_roomId__placeable__3pN_c",leaveButton:"_roomId__leaveButton__bT1dY",gameScreen:"_roomId__gameScreen__iMdSO",gameInfo:"_roomId__gameInfo__biTuf",playerInfo:"_roomId__playerInfo__KQ0u9",playerSelf:"_roomId__playerSelf__jc68x",playerOpponent:"_roomId__playerOpponent__peHNX",boardContainer:"_roomId__boardContainer__uFQZM",playerLeft:"_roomId__playerLeft__tz3OZ",playerRight:"_roomId__playerRight__k06ze",userInfo:"_roomId__userInfo__GqWcK",userSelf:"_roomId__userSelf__Ynxqs",userOpponent:"_roomId__userOpponent__n_zkD"}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8295)}),_N_E=e.O()}]);