(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{8295:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[roomId]",function(){return a(658)}])},658:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return index_page}});var o=a(5893),t=a(7294),l=a(9854),r=a(3483),c=a(6819);let judgeColor=(e,n)=>{let a=null==n?void 0:n.userOnRooms.filter(e=>null===e.out).sort((e,n)=>e.in-n.in),o=null==a?void 0:a.findIndex(n=>n.firebaseId===e);return 0===o?1:2},convertToBlackOrWhite=e=>1===e?"#000":2===e?"#fff":"";var i=a(8493),s=a.n(i),GameInfo_GameInfo=e=>{var n;let{myColor:a,room:t}=e,l=convertToBlackOrWhite(a),r=convertToBlackOrWhite(2/a);return(0,o.jsxs)("div",{className:s().gameInfo,children:[(0,o.jsxs)("div",{className:s().playerInfo,children:["あなた",(0,o.jsx)("div",{className:s().stone,style:{background:l,color:r},children:t.board.flat().filter(e=>e===a).length})]}),"waiting"===t.status?(0,o.jsx)("p",{children:"対戦相手を待っています"}):(0,o.jsxs)("p",{children:[t.currentTurn===a?"あなた":"相手","のターン"]}),(0,o.jsxs)("div",{className:s().playerInfo,children:["相手",(0,o.jsx)("div",{className:s().stone,style:{background:r,color:l},children:(n=2/a,t.board.flat().filter(e=>e===n).length)})]})]})},d=a(8583),u=a(1163),_=a(6221);let useRoomData=()=>{let[e]=(0,d.KO)(_.L),n=(0,u.useRouter)(),{roomId:a}=n.query,[o,l]=(0,t.useState)(),[i,s]=(0,t.useState)([[]]),fetchRooms=async()=>{let e=await r.x.rooms.$get().catch(c.F);return e||null},fetchPlaceableMatrix=async(e,n)=>{let a=await r.x.rooms.board.$get({query:{roomId:e,turnColor:n}}).catch(c.F);return a||null},fetchAndSetRoomData=async()=>{let e=await fetchRooms();if(!e)return;let n=e.find(e=>e.id===a);if(!n)return;let o=await fetchPlaceableMatrix(n.id,n.currentTurn);o&&(s(o),l(n))};return{room:o,user:e,router:n,placeableMatrix:i,fetchAndSetRoomData}};var f=a(7794),m=a.n(f),index_page=()=>{let{room:e,user:n,router:a,placeableMatrix:i,fetchAndSetRoomData:s}=useRoomData();if((0,t.useEffect)(()=>{if((null==e?void 0:e.winner)===1||(null==e?void 0:e.winner)===2){handleGameEnd();return}if((null==e?void 0:e.status)==="ended"){handleOpponentLeave();return}let n=setInterval(s,1e3);return()=>clearInterval(n)}),void 0===e||!n)return(0,o.jsx)(l.g,{visible:!0});let d=judgeColor(n.id,e),leaveRoom=async()=>{let n=await r.x.rooms.$patch({body:{roomId:e.id}}).catch(c.F);null!==n&&await a.push("/")},clickCell=async(n,a)=>{let o=await r.x.rooms.board.$post({body:{x:n,y:a,roomId:e.id}});o&&await s()},handleOpponentLeave=()=>{alert("対戦相手が部屋を出たため、対局が終了しました"),leaveRoom()},handleGameEnd=()=>{let n=e.winner===d?"あなた":"相手";alert("".concat(n,"の勝ちです")),leaveRoom()},defineCellStyle=n=>-1!==n?m().stone:e.currentTurn===d?"".concat(m().stone," ").concat(m().placeable):"";return(0,o.jsxs)("div",{className:m().gameScreen,children:[GameInfo_GameInfo({myColor:d,room:e}),(0,o.jsx)("div",{className:m().boardContainer,children:(0,o.jsx)("div",{className:m().board,children:i.map((e,n)=>e.map((e,a)=>(0,o.jsx)("div",{className:m().cell,onClick:()=>clickCell(a,n),children:0!==e&&(0,o.jsx)("div",{className:"".concat(defineCellStyle(e)),style:{background:convertToBlackOrWhite(e)}})},"".concat(a,"-").concat(n))))})}),(0,o.jsx)("button",{onClick:leaveRoom,className:m().leaveButton,children:"部屋を出る"})]})}},8493:function(e){e.exports={stone:"GameInfo_stone__UifQO",gameInfo:"GameInfo_gameInfo__8js_j",playerInfo:"GameInfo_playerInfo__fnxG5"}},7794:function(e){e.exports={gameScreen:"_roomId__gameScreen__iMdSO",boardContainer:"_roomId__boardContainer__uFQZM",board:"_roomId__board__FCi4O",cell:"_roomId__cell__A40dx",stone:"_roomId__stone__ER09g",placeable:"_roomId__placeable__3pN_c",leaveButton:"_roomId__leaveButton__bT1dY"}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8295)}),_N_E=e.O()}]);